package com.cart.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.cart.entity.Cart;
import com.cart.entity.CartItem;
import com.cart.repository.CartRepository;


@Service
public class CartServiceImpl implements ICartService{

        @Autowired
        private RestTemplate restTemplate;
 
  @Autowired
  private CartRepository cartRepo;
      
  public String addItemToCart(String cartid, String cropid, int quantity) {
	  
              Cart cart = cartRepo.findById(cartid).orElse(null);

            if (cart == null) {
             return "Cart Not Found";
               }

      
      CartItem crop = restTemplate.getForObject("http://CROP/crop/getById/" + cropid, CartItem.class);

      if (crop == null) {
          return "Crop Not Found";
      }

      // Create a CartItem and add it to the cart
      CartItem cartItem = new CartItem();
      cartItem.setCropid(crop.getCropid());
      cartItem.setCropName(crop.getCropName());
      cartItem.setCropType(crop.getCropType());
      cartItem.setQuantity(quantity);
      cartItem.setPrice(crop.getPrice());

      // Add the cart item to the cart
      cart.getCartItems().add(cartItem);

      // Update the total cost of the cart
      cart.setTotalCost(cart.getTotalCost() + (quantity * crop.getPrice()));

      // Save the updated cart
      cartRepo.save(cart);

      return "Item added to the cart successfully.";
  }
  

 
}







 

 

}

